<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title></title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>

    <style>
    

    .node {
        fill: #ccc;
        stroke: #fff;
        stroke-width: 2px;
    }

    .link {
        stroke: #777;
        stroke-width: 2px;
    }

    .hide{
      display:none;
    }

    li{
      list-style: none;
      border: 2px solid #ccc;
      display: block;
      position: fixed;
      top: 50%;
      left:50%;
      opacity: 0;

    }


    </style>

  </head>
  <body>
    <main>
      <form id="scopus-search-form">
        <input type="text" id="query" placeholder="search papers">
        <button type="submit">Search</button>
      </form>

      <form id="run-d3">
        <button type="submit">viz</button>
      </form>
      <ul id= 'titles'>

      </ul>
      <div class="graph">

      </div>
  </body>

  <script src="finalproject.js" type="text/javascript">  </script>

  <script src="http://d3js.org/d3.v3.min.js"></script>



<script>
function makelinks(){
  var nodes = papers.nodes
  var links = papers.links;
  for (var k = 0; k< papers.links.length; k++) {
    while (!links[k]['source']) {
      for (var i = 0; i < papers.nodes.length; i++) {
        // console.log(nodes[i]['doi']+' '+links[k]['sourcedoi'])

        if (nodes[i]['doi']==links[k]['sourcedoi']){
          links[k]['source']=i
          // console.log('match!'+  links[k]['source']);

          {break}
        }
      }
    }

  }
}

// for (var i = 0; i < papers.links.length; i++) {
// console.log(nodes[i]['doi']);
//
// }
var papers = JSON.parse(localStorage.getItem('paperStorage'));
function findmin(array){
  var currentmin = 2016;
  for (var i = 0; i < array.length; i++) {
    if (array[i]< currentmin){
      currentmin=array[i]
    }
  }
  return currentmin
}

function runViz(){
  var width = 900,
   height = 400;


  var nodes = papers.nodes;
  makelinks()
  var links = papers.links;
  var nodes = papers.nodes;

  var minyear= findmin(nodes);
  var maxyear = 2016
  var range = maxyear-minyear;
  console.log(minyear);

if (range==0) {
  range = 50;
  minyear = maxyear-50;
}



var svg = d3.select('body').append('svg')
    .attr('width', width)
    .attr('height', height);

var force = d3.layout.force()
    .nodes(nodes)
    .links(links)
    .size([width, height])
    .linkStrength(0.1)
    .friction(0.9)
    .linkDistance(30)
    .charge(-30)
    .gravity(0.1)
    .theta(0.8)
    .alpha(0.1);




//
//   var vis = d3.select(".graph")
//             .append("svg");
//

//      vis.attr("width", w)
//         .attr("height", h);
//

var link = svg.selectAll('.link')
    .data(links)
    .enter().append('line')
    .attr('class', 'link');

// Now it's the nodes turn. Each node is drawn as a circle.

var node = svg.selectAll('.node')
    .data(nodes)
    .enter().append('circle')
    .attr('class', 'node')
    .call(force.drag);
;


force.on('tick', function() {

  node.attr("cx", function(d) { return d.x; })
  .attr("cy", function(d) {return d.y; })
  .attr("r", function(d) {return Number(d['value']+1);});

  link.attr('x1', function(d) { return d.source.x; })
      .attr('y1', function(d) { return d.source.y; })
      .attr('x2', function(d) { return d.target.x; })
      .attr('y2', function(d) { return d.target.y; });







});

force.start();

}





		</script>
	</body>
</html>


</script>

</html>
