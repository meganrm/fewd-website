<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>firebase first try</title>
    <link rel="stylesheet" href="css/chatstylesheet.css" media="screen" title="no title" charset="utf-8">
    <script src="https://cdn.firebase.com/js/client/2.2.1/firebase.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
  </head>
  <body>
<div class="chatbar">

    <form id="chatbox" >
      <input type="text" id="new-message" placeholder="How are you feeling?">
      <button type="submit">Send</button>
    </form>

</div>

    <ul id="message-list">
    </ul>


<script type="text/javascript">
var firebase = new Firebase("https://blinding-inferno-7422.firebaseio.com")

function newTagText(tagType, parent, text){
        var elementName=document.createElement(tagType);
        parent.appendChild(elementName);
        elementName.textContent=text;
        return elementName;
      };

var messagelist= document.querySelector('#message-list')
var sendbutton = document.querySelector('#chatbox');
sendbutton.addEventListener('submit', sendmessage);
var localusername= localStorage.getItem('username');


firebase.limitToLast(10).on('child_added', function (snapshot) {
    var results = snapshot.val();
      // for (var key in results) {
      //   if (results.hasOwnProperty(key)) {
//    debugger
    var li = newTagText('li', messagelist)
    var span = newTagText('span', li, results['messageBody'])
    span.classList.add('message')
    var name = newTagText('div', li, results['username'])
    name.classList.add('username')

      //   }
      //
      // }
     console.log(results);
});

function sendmessage(event){
  event.preventDefault()
  var message = document.querySelector('#new-message').value
//  console.log(message);
  if (!(localusername)){
      localusername=storeusername()
    };
  firebase.push({
      username: localusername,
      messageBody: message
    })}


function storeusername() {
      var un = prompt("what is your username")
      localStorage.setItem("username", un)
      return un;
}


    </script>
  </body>
</html>
